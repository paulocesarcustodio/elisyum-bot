name: Deploy to LXC

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    name: Deploy Bot to LXC
    runs-on: ubuntu-latest
    
    steps:
    - name: üöÄ Deploy via SSH
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.LXC_HOST }}
        username: ${{ secrets.LXC_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        port: 22
        script: |
          cd ${{ secrets.LXC_BOT_PATH }}
          
          echo "üîÑ Pulling latest changes..."
          git pull origin main
          
          echo "üì¶ Installing dependencies..."
          bun install --frozen-lockfile
          
          echo "üî® Building project..."
          bun run build
          
          echo "üîÑ Restarting bot..."
          pkill -f "bun.*start" || true
          sleep 2
          nohup bun run start > bot.log 2>&1 &
          
          echo "‚úÖ Deploy completed!"
          sleep 3
          ps aux | grep "bun.*start" | grep -v grep || echo "‚ö†Ô∏è Check bot.log"
